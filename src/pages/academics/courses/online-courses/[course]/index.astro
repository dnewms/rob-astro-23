---
import Layout from '../../../../../layouts/MainLayout.astro';
import { getCollection, render } from 'astro:content';
import Breadcrumbs from '../../../../../components/Breadcrumbs.astro';

export async function getStaticPaths() {
  const courseEntries = await getCollection('courses');
  
  // Get unique course names from the entries
  const courses = [...new Set(courseEntries.map(entry => {
    // Handle both cases: entries in root and in subdirectories
    return entry.id.includes('/') ? entry.id.split('/')[0] : entry.id;
  }))];
  
  return courses.map(course => {
    return {
      params: { course },
      props: { 
        entry: courseEntries.find(e => e.id === `${course}/index` || e.id === course),
        courseEntries: courseEntries.filter(e => {
          const entryPath = e.id.includes('/') ? e.id.split('/')[0] : e.id;
          return entryPath === course && e.id !== `${course}/index`;
        })
      }
    };
  });
}

const { entry } = Astro.props;
if (!entry) {
  throw new Error(`No course found: ${Astro.params.course}`);
}
const { Content } = await render(entry);
---

<Layout title={entry.data.title}>
  <div class="max-w-6xl w-11/12 mx-auto py-12">
    
    <article class="prose prose-lg prose-invert max-w-none">
      <h1>{entry.data.title}</h1>
      <Content />
    </article>
  </div>
</Layout>