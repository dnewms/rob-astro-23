---
import Layout from '../../../layouts/MainLayout.astro';
import Single from '../../../components/templates/Single.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const newsEntries = await getCollection('news');
  
  return newsEntries.map(entry => {
    const year = entry.data.date.split('-')[0];
    const slug = entry.id.split('/')[1];
    
    return {
      params: { year, slug },
      props: { entry }
    };
  });
}

const { entry } = Astro.props;
const { Content } = await render(entry);

// Create excerpt for SEO description
const description = entry.data.excerpt || entry.data.description || `${entry.data.title}`;

// Generate OG image URL
const ogImage = `/news/${entry.data.date.split('-')[0]}/${entry.id.split('/')[1]}/og-image.png`;

// Transform entry data to match Single template's expected node structure
const node = {
  title: entry.data.title,
  date: entry.data.date,
  author: entry.data.author || null,
  categories: entry.data.categories ? {
    nodes: entry.data.categories.map(cat => ({
      name: cat,
      uri: `/category/${cat}`
    }))
  } : null,
  featuredImage: entry.data.image ? {
    node: {
      mediaItemUrl: `/src/content/news/${entry.data.image.src}`,
      altText: entry.data.title
    }
  } : null,
  __typename: 'Post'
};
---

<Layout 
  title={entry.data.title}
  description={description}
  image={ogImage}
>
  <Single node={node}>
    <Content slot="content" />
  </Single>
</Layout>

<style>
  :global(.content-wrapper) {
    display: none;
  }
</style>
