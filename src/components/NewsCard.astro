---
import { Image } from 'astro:assets';

interface Props {
  title: string;
  date: Date;
  slug: string;
  content: string;  // Changed from excerpt to content since we'll generate excerpt
  image?: {
    src: any;  // ImageMetadata type
    alt: string;
  };
  isLarge?: boolean;
}

const { 
  title, 
  date, 
  slug, 
  content, 
  image, 
  isLarge = false 
} = Astro.props;

// getExcerpt function built into the component
function getExcerpt(content: string, maxLength: number = 160): string {
  // Remove HTML tags
  const strippedContent = content.replace(/<[^>]+>/g, '');
  
  // If content is shorter than maxLength, return it all
  if (strippedContent.length <= maxLength) {
    return strippedContent;
  }
  
  // Find the last space before maxLength
  const truncated = strippedContent.substring(0, maxLength);
  const lastSpace = truncated.lastIndexOf(' ');
  
  // Return content up to the last space plus ellipsis
  return truncated.substring(0, lastSpace) + '...';
}

const excerpt = getExcerpt(content);
---

<a href={`/news/${slug}`} 
   class={`group block bg-gray-100 dark:bg-gray-700 shadow-md rounded-sm overflow-hidden hover:shadow-lg transition-all duration-300 hover:scale-[1.02] ${isLarge ? 'md:col-span-2' : ''}`}>
  {image && (
    <Image 
      src={image.src}
      alt={image.alt || 'News image'}
      width={1024}
      height={683}
      class={`w-full ${isLarge ? 'h-96' : 'h-48'} object-cover`}
    />
  )}
  <div class="p-4">
    <h3 class="text-xl font-roboto font-bold mb-2 text-umichblue dark:text-gray-100 border-b-2 border-transparent group-hover:border-maize transition-all duration-300">{title}</h3>
    <p class="text-sm italic font-sans text-gray-600 dark:text-gray-400 mb-4">
      {date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
    </p>
    <p class="text-gray-600 dark:text-gray-200 mb-4">{excerpt}</p>
  </div>
</a>