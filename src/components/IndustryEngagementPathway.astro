---
import { Image } from "astro:assets";
import pathwaySpeaker from "../images/partnerships/pathway-speaker.jpg";
import studentTeams from "../images/partnerships/student-teams.jpg";
import careerFair from "../images/partnerships/career-fair.jpg";
import mdp from "../images/partnerships/mdp.jpg";
import iucrc from "../images/partnerships/iucrc.jpg";
import centersChairs from "../images/partnerships/centers-chairs.jpg";
import sponsoredResearch from "../images/partnerships/sponsored-research.jpg";
import { YouTube } from "astro-embed";

const engagementPoints = [
  {
    title: "Pathways speaker",
    description: "Share industry insights through our speaker series.",
    level: "Initial",
    media: {
      type: "image",
      src: pathwaySpeaker,
      alt: "Industry leader shares insights to a crowd at Robotics Pathways Speaker Series",
      description: "Previous speakers include leaders from Boston Dynamics, NASA JPL, Ford, and other leading robotics organizations. View the <a href='/events/pathway-speaker-series'>Pathway Speaker Series</a> page for more information."
    }
  },
  {
    title: "Student teams",
    description: "Support and mentor student robotics projects.",
    level: "Initial",
    media: {
      type: "image", 
      src: studentTeams,
      alt: "A Michigan Mars Rover team member drives the rover over the Mars Yard outside the Robotics Building",
      description: "Support teams like M-Fly, MRacing, Michigan Mars Rover, and Michigan Autonomous Aerial Vehicles. Read more about <a href='/people/student-teams'>our student teams</a>."
    }
  },
  {
    title: "Career fairs",
    description: "Connect directly with top robotics talent.",
    level: "Mid-Level",
    media: {
      type: "image", 
      src: careerFair,
      alt: "U-M students visit a table at the Robotics Career Fair to talk to industry representatives",
      description: "Attend Robotics career fairs to meet rising robotics talent for internships and full-time positions."
    }
  },
  {
    title: "ROB 450 and ROB 550",
    description: "Participate in senior-level and graduate-level robotics courses.",
    level: "Mid-Level",
    media: {
      type: "video", 
      src: "0iuTI2xilDQ",
      alt: "A video on ROB 550 that shows the course projects",
      description: "Students complete projects putting their knowledge to use in industry-relevant contexts."
    }
  },
  {
    title: "Multidisciplinary Design Program",
    description: "Collaborate on Michigan Design Program projects.",
    level: "Advanced",
    media: {
      type: "image", 
      src: mdp,
      alt: "A Spot quadruped robot helps students with an agricultural project",
      description: "Collaborate on MDP projects, which form an entire course around industry projects. Read more about the <a href='https://mdp.engin.umich.edu/'>program</a>."
    }
  },
  {
    title: "Sponsored research",
    description: "Funded research projects to advance robotics.",
    level: "Advanced",
    media: {
      type: "image", 
      src: sponsoredResearch,
      alt: "An autonomous vehicles drives around Mcity",
      description: "Projects can range in scope from a single thesis to a multi-year, joint effort."
    }
  },
  {
    title: "Industry-University Research Partnerships",
    description: "Join our Industry-University Research Centers.",
    level: "Advanced",
    media: {
      type: "image", 
      src: iucrc,
      alt: "A robotic knee prosthetic is displayed at an international conference",
      description: "National Science Foundation IUCRCs tackle national challenges in robotics with  many benefits to industry. Read about one focused on <a href='https://sites.google.com/umich.edu/digitaltwincenter/home/manufacturing'>Digital Twins in Manufacturing</a> and one on <a href='https://robotics.umich.edu/2023/u-m-partners-with-autonomous-air-mobility-center/'>Autonomous Air Mobility</a>."
    }
  },
  {
    title: "Centers, chairs, and facilities",
    description: "Fund and access research facilities and establish collaborations.",
    level: "Advanced",
    media: {
      type: "image", 
      src: centersChairs,
      alt: "An aerial view of North Campus at the University of Michigan",
      description: "Roboticists at Michigan are changing the shape of the future: we are looking to invite major partners to realize our vision."
    }
  }
];

const groupedPoints = {
  "Initial": engagementPoints.filter(p => p.level === "Initial"),
  "Mid-Level": engagementPoints.filter(p => p.level === "Mid-Level"),
  "Advanced": engagementPoints.filter(p => p.level === "Advanced")
};
function getHrClass(level) {
    switch(level) {
      case 'Initial': return 'hr-initial';
      case 'Mid-Level': return 'hr-mid-level';
      case 'Advanced': return 'hr-advanced';
      default: return '';
    }
  }
---
<div class="max-w-6xl mx-auto p-6">
  <div id="main-content" class="relative space-y-12">
    {Object.entries(groupedPoints).map(([level, points], levelIndex) => (
      <section class="engagement-level relative">
        <div class="flex items-center gap-4 mb-6">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white whitespace-nowrap not-prose">{level}</h3>
          <hr class={`flex-grow h-0.5 border-0 not-prose ${getHrClass(level)}`} />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {points.map((point) => (
            <div 
              class="engagement-point" 
              role="article" 
              aria-labelledby={`engagement-title-${point.title}`}
              tabindex="0"
              aria-expanded="false"
            >
              <div class={`engagement-point-content rounded-lg shadow-sm p-4 border border-gray-100 dark:border-gray-700 dark:bg-gray-800 ${level === 'Initial' ? 'bg-maize bg-opacity-5' : ''} ${level === 'Mid-Level' ? 'bg-taubmanTeal bg-opacity-10' : ''} ${level === 'Advanced' ? 'bg-arboretumBlue bg-opacity-10' : ''}`}>
                <div class="flex items-start gap-3">
                  <div class={`w-3 h-3 mt-1.5 rounded-full transition-colors duration-300 ${level === 'Initial' ? 'bg-maize dark:bg-maize' : ''} ${level === 'Mid-Level' ? 'bg-taubmanTeal' : ''} ${level === 'Advanced' ? 'bg-arboretumBlue' : ''}`}></div>
                  <div class="w-full">
                    <h4 id={`engagement-title-${point.title}`} class="font-bold text-gray-900 dark:text-white not-prose">{point.title}</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-300 not-prose">{point.description}</p>
                  </div>
                </div>
                {point.media && (
                  <div class="engagement-point-media mt-4 space-y-3">
                    {point.media.type === "image" && (
                      <div class="rounded-lg overflow-hidden">
                        <Image 
                          src={point.media.src} 
                          alt={point.media.alt} 
                          class="w-full h-48 object-cover" 
                          width={1200} 
                          height={630} 
                        />
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2" set:html={point.media.description}></p>
                      </div>
                    )}
                    {point.media.type === "video" && (
                      <>
                        <YouTube id={point.media.src} class="w-full aspect-video" />
                        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2" set:html={point.media.description}></p>
                      </>
                    )}
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      </section>
    ))}
  </div>
</div>

<style>
  .engagement-point {
    transition: margin-bottom 0.3s ease;
  }
  .engagement-point-content {
    transition: all 0.3s ease;
    color: #333;
    cursor: pointer;
  }
  .engagement-point:hover .engagement-point-content,
  .engagement-point.expanded .engagement-point-content {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }
  .engagement-point-media {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease;
  }
  .engagement-point:hover .engagement-point-media,
  .engagement-point.expanded .engagement-point-media {
    max-height: 400px;
    opacity: 1;
  }
  .hr-initial {
    background: linear-gradient(to right, #ffcb05, transparent);
  }
  .hr-mid-level {
    background: linear-gradient(to right, #00B2A9, transparent);
  }
  .hr-advanced {
    background: linear-gradient(to right, #2F65A7, transparent);
  }
    
  /* Only apply hover effects on devices that support hover */
  @media (hover: hover) {
    .engagement-point:hover .engagement-point-media {
      max-height: 400px;
      opacity: 1;
    } 
  }
  .engagement-point:focus-within {
    outline: 2px solid #007bff;
    outline-offset: 2px;
  }
  @media (prefers-color-scheme: dark) {
    .engagement-point-content {
      color: #f0f0f0;
    }
    .hr-initial {
      background: linear-gradient(to right, #ffcb05, transparent);
    }
    .hr-mid-level {
      background: linear-gradient(to right, #75988d, transparent);
    }
    .hr-advanced {
      background: linear-gradient(to right, #2F65A7, transparent);
    }
  }
</style>

<script>
  document.querySelectorAll('.engagement-point').forEach(point => {
    // Track if point is expanded
    let isExpanded = false;

    // Handle click/tap events
    point.addEventListener('click', function(e) {
      e.preventDefault();
      
      // Close all other points
      document.querySelectorAll('.engagement-point').forEach(otherPoint => {
        if (otherPoint !== point) {
          otherPoint.style.marginBottom = '0';
          otherPoint.setAttribute('aria-expanded', 'false');
          otherPoint.classList.remove('expanded');
        }
      });

      // Toggle current point
      isExpanded = !isExpanded;
      this.classList.toggle('expanded');
      this.setAttribute('aria-expanded', isExpanded);
      
      if (isExpanded) {
        const contentHeight = this.querySelector('.engagement-point-media').offsetHeight;
        this.style.marginBottom = `${contentHeight}px`;
      } else {
        this.style.marginBottom = '0';
      }
    });

    // Keep hover effect for desktop only
    if (window.matchMedia('(hover: hover)').matches) {
      point.addEventListener('mouseenter', function() {
        if (!isExpanded) {
          const contentHeight = this.querySelector('.engagement-point-media').offsetHeight;
          this.style.marginBottom = `${contentHeight}px`;
          this.setAttribute('aria-expanded', 'true');
          this.classList.add('expanded');
          isExpanded = true;
        }
      });

      point.addEventListener('mouseleave', function() {
        if (!this.contains(document.activeElement)) {
          this.style.marginBottom = '0';
          this.setAttribute('aria-expanded', 'false');
          this.classList.remove('expanded');
          isExpanded = false;
        }
      });
    }
  });
</script>